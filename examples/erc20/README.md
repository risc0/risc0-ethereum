# ERC20 Example
We provide an example that uses the ERC20 interface's `balanceOf` method.
> ***WARNING***: This software is still experimental, we do not recommend it for production use.

## Prerequisites
To get started, you need to have Rust installed. If you haven't done so, follow the instructions [here][install-rust]. 

Next, install the `cargo risczero` tool. We'll use `cargo binstall` to facilitate this. Detailed instructions can be found at [cargo-binstall].

```bash
cargo install cargo-binstall
cargo binstall cargo-risczero
```

Finally, install the `risc0` toolchain with the following command:

```bash
cargo risczero install
```

You'll also need access to an Ethereum RPC node, such as through [Alchemy](www.alchemy.com).

## Run the example
To run the example, which queries the USDT balance of `0x9737100D2F42a196DE56ED0d1f6fF598a250E7E4` on Sepolia, execute the following command:

```bash
RPC_URL=https://eth-sepolia.g.alchemy.com/v2/<API_KEY> RUST_LOG=info cargo run --release
```

The output should resemble the following:

```
2024-03-12T11:06:14.549457Z  INFO view_call::host: preflight 'balanceOf(address)' method by 0xf08A50178dfcDe18524640EA6618a1f965821715 on 0xaA8E23Fb1079EA71e0a56F48a2aA51851D8433D0
For block 5470081 `balanceOf(address)` returns: 399534748753251
Running the guest with the constructed input:
View call result: 399534748753251
2024-03-12T11:06:17.018205Z  INFO executor: risc0_zkvm::host::server::exec::executor: execution time: 538.5ms
2024-03-12T11:06:17.018224Z  INFO executor: risc0_zkvm::host::server::session: number of segments: 6
2024-03-12T11:06:17.018227Z  INFO executor: risc0_zkvm::host::server::session: total cycles: 5505024
2024-03-12T11:06:17.018229Z  INFO executor: risc0_zkvm::host::server::session: user cycles: 4179903
2024-03-12T11:06:17.018231Z  INFO executor: risc0_zkvm::host::server::session: cycle efficiency: 75%
```

### Guest Code
Here is a snippet of the [relevant code](./methods/guest/src/main.rs) of the guest:

```rust
/// Specify the function to call using the [`sol!`] macro.
/// This parses the Solidity syntax to generate a struct that implements the [SolCall] trait.
/// The struct instantiated with the arguments can then be passed to the [ViewCall] to execute the
/// call. For example:
/// `IERC20::balanceOfCall { account: address!("9737100D2F42a196DE56ED0d1f6fF598a250E7E4") }`
sol! {
    /// ERC-20 balance function signature.
    interface IERC20 {
        function balanceOf(address account) external view returns (uint);
    }
}

/// Function to call, implements [SolCall] trait.
const CALL: IERC20::balanceOfCall =
    IERC20::balanceOfCall { account: address!("9737100D2F42a196DE56ED0d1f6fF598a250E7E4") };

/// Address of the deployed contract to call the function on. Here: USDT contract on Sepolia
const CONTRACT: Address = address!("aA8E23Fb1079EA71e0a56F48a2aA51851D8433D0");
/// Address of the caller of the function. If not provided, the caller will be the [CONTRACT].
const CALLER: Address = address!("f08A50178dfcDe18524640EA6618a1f965821715");

fn main() {
    // Read the input from the guest environment.
    let input: EthViewCallInput = env::read();

    // Converts the input into a `ViewCallEnv` for execution. The `with_chain_spec` method is used
    // to specify the chain configuration. It checks that the state matches the state root in the
    // header provided in the input.
    let view_call_env = input.into_env().with_chain_spec(&ETH_SEPOLIA_CHAIN_SPEC);
    // Commit the block hash and number used when deriving `view_call_env` to the journal.
    env::commit_slice(&view_call_env.block_commitment().abi_encode());

    // Execute the view call; it returns the result in the type generated by the `sol!` macro.
    let returns = ViewCall::new(CALL, CONTRACT).with_caller(CALLER).execute(view_call_env);
    println!("View call result: {}", returns._0);
}
```

## Host Code

Here is a snippet to the [relevant code](./host/src/main.rs) on the host, it requires the same arguments as the guest:

```rust
// Create a view call environment from an RPC endpoint and a block number. If no block number is
// provided, the latest block is used. The `with_chain_spec` method is used to specify the
// chain configuration.
let env = EthViewCallEnv::from_rpc(&RPC_URL, None)?
    .with_chain_spec(&ETH_SEPOLIA_CHAIN_SPEC);

// Preflight the view call to construct the input that is required to execute the function in
// the guest. It also returns the result of the call.
let (input, returns) = ViewCall::new(CALL, CONTRACT)
    .with_caller(CALLER)
    .preflight(env)?;
```

[install-rust]: https://doc.rust-lang.org/cargo/getting-started/installation.html
[cargo-binstall]: https://github.com/cargo-bins/cargo-binstall#cargo-binaryinstall